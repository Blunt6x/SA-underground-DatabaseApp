
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin - SA Underground</title>
<link rel="stylesheet" href="styles/style.css">
<style>
  /* simple admin overrides */
  .admin-wrap{max-width:900px;margin:24px auto;padding:18px;background:rgba(255,255,255,0.03);border-radius:12px}
  .form-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
  .form-row input, .form-row textarea{flex:1;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff}
  .artist-list-admin{margin-top:12px}
  .artist-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);margin-bottom:8px}
  .artist-item button{margin-left:8px}
  .login-box{max-width:420px;margin:20px auto;padding:18px}
</style>
</head>
<body>
  <header class="site-header"><div class="brand"><h1>Admin â€” SA Underground</h1></div></header>
  <main class="container">
    <div id="auth" class="login-box">
      <h3>Admin login</h3>
      <div class="form-row"><input id="user" placeholder="username"></div>
      <div class="form-row"><input id="pass" type="password" placeholder="password"></div>
      <div class="form-row"><button id="loginBtn" class="btn">Log in</button></div>
      <div id="loginMsg" style="color:var(--muted)"></div>
    </div>

    <div id="adminArea" style="display:none">
      <div class="admin-wrap">
        <h3>Add new artist</h3>
        <div class="form-row">
          <input id="name" placeholder="Name">
          <input id="id" placeholder="id (optional)">
        </div>
        <div class="form-row">
          <input id="followers" placeholder="Followers / monthly_listeners">
          <input id="image" placeholder="Image (e.g. images/artist.jpg)">
        </div>
        <div class="form-row">
          <input id="spotify" placeholder="Spotify URL">
          <input id="instagram" placeholder="Instagram URL">
        </div>
        <div class="form-row">
          <textarea id="bio" placeholder="Bio / city"></textarea>
        </div>
        <div class="form-row">
          <button id="addBtn" class="btn">Add Artist</button>
        </div>

        <h3>Existing artists</h3>
        <div id="artistsAdmin" class="artist-list-admin"></div>
      </div>
    </div>
  </main>

<script>
let token = null;
const loginBtn = document.getElementById('loginBtn');
loginBtn.addEventListener('click', async ()=>{
  const u = document.getElementById('user').value;
  const p = document.getElementById('pass').value;
  const res = await fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u,password:p})});
  if (res.status===200){ const j=await res.json(); token=j.token; document.getElementById('auth').style.display='none'; document.getElementById('adminArea').style.display='block'; loadArtists(); }
  else { document.getElementById('loginMsg').textContent='Invalid creds'; }
});

async function loadArtists(){
  const res = await fetch('/api/artists'); const list = await res.json();
  const wrap = document.getElementById('artistsAdmin'); wrap.innerHTML='';
  list.forEach(a=>{
    const div = document.createElement('div'); div.className='artist-item';
    div.innerHTML = `<div><strong>${a.name}</strong> <small style="color:var(--muted)">(${a.id})</small></div>
      <div>
        <button class="editBtn">Edit</button>
        <button class="delBtn">Delete</button>
      </div>`;
    wrap.appendChild(div);

    div.querySelector('.editBtn').addEventListener('click', ()=> populateEdit(a));
    div.querySelector('.delBtn').addEventListener('click', ()=> doDelete(a.id));
  });
}

function populateEdit(a){
  document.getElementById('name').value = a.name || '';
  document.getElementById('id').value = a.id || '';
  document.getElementById('followers').value = a.followers || '';
  document.getElementById('image').value = a.image || '';
  document.getElementById('spotify').value = a.spotify || '';
  document.getElementById('instagram').value = a.instagram || '';
  document.getElementById('bio').value = a.bio || '';
  // change add to update
  document.getElementById('addBtn').textContent = 'Update Artist';
  document.getElementById('addBtn').onclick = ()=> doUpdate(a.id);
}

async function doUpdate(id){
  const payload = {
    id: document.getElementById('id').value || id,
    name: document.getElementById('name').value,
    followers: document.getElementById('followers').value,
    image: document.getElementById('image').value,
    spotify: document.getElementById('spotify').value,
    instagram: document.getElementById('instagram').value,
    bio: document.getElementById('bio').value
  };
  const res = await fetch('/api/artists/'+encodeURIComponent(id), {method:'PUT', headers:{'Content-Type':'application/json','X-Auth-Token':token}, body:JSON.stringify(payload)});
  if (res.ok) { alert('Updated'); loadArtists(); resetForm(); }
  else alert('Update failed');
}

async function doDelete(id){
  if (!confirm('Delete artist?')) return;
  const res = await fetch('/api/artists/'+encodeURIComponent(id), {method:'DELETE', headers:{'X-Auth-Token':token}});
  if (res.ok) { alert('Deleted'); loadArtists(); }
  else alert('Delete failed');
}

document.getElementById('addBtn').addEventListener('click', async ()=>{
  if (document.getElementById('addBtn').textContent === 'Update Artist') return;
  const payload = {
    id: document.getElementById('id').value || undefined,
    name: document.getElementById('name').value,
    followers: document.getElementById('followers').value,
    image: document.getElementById('image').value,
    spotify: document.getElementById('spotify').value,
    instagram: document.getElementById('instagram').value,
    bio: document.getElementById('bio').value
  };
  const res = await fetch('/api/artists', {method:'POST', headers:{'Content-Type':'application/json','X-Auth-Token':token}, body:JSON.stringify(payload)});
  if (res.ok) { alert('Added'); loadArtists(); resetForm(); }
  else { alert('Add failed'); }
});

function resetForm(){
  document.getElementById('name').value = '';
  document.getElementById('id').value = '';
  document.getElementById('followers').value = '';
  document.getElementById('image').value = '';
  document.getElementById('spotify').value = '';
  document.getElementById('instagram').value = '';
  document.getElementById('bio').value = '';
  document.getElementById('addBtn').textContent = 'Add Artist';
  document.getElementById('addBtn').onclick = null;
}
</script>
</body>
</html>
